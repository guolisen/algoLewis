Kubernetes（k8s）是容器编排领域的事实标准，面试中常围绕其核心概念、架构、核心组件、资源管理、网络、调度、运维等展开。以下是最常见的面试题及解析：

### 一、核心概念与基础理论

#### 1. 什么是 Kubernetes？它解决了什么问题？

- **定义**：Kubernetes 是一个开源的容器编排平台，用于自动化部署、扩展和管理容器化应用程序。
- **解决的问题**：
    - 容器的批量部署与生命周期管理（启动、停止、重启等）；
    - 容器间的网络通信与服务发现；
    - 动态扩缩容（根据负载自动调整实例数量）；
    - 故障自愈（容器崩溃后自动重启）；
    - 资源（CPU、内存）的合理分配与限制；
    - 滚动更新与回滚（避免更新时服务中断）。

#### 2. 什么是 Pod？它与容器的关系是什么？

- **Pod**：k8s 最小的部署单元，是一组紧密关联的容器的集合，共享网络命名空间（IP 和端口）和存储卷（Volume）。
- **与容器的关系**：
    - 容器是 Pod 的组成部分，一个 Pod 可包含 1 个（单容器 Pod）或多个（多容器 Pod）容器；
    - 多容器 Pod 中的容器通常协同工作（如一个容器处理业务，另一个容器日志收集），需在同一节点上运行。
- **特点**：Pod 是临时的，销毁后重建会生成新的 IP，因此不直接对外提供服务，需通过 Service 暴露。

#### 3. 什么是 Service？它的作用是什么？

- **Service**：定义了 Pod 的访问方式，为一组具有相同功能的 Pod 提供固定访问入口（IP 和端口），**实现 Pod 的 “服务发现” 和 “负载均衡”**。
- **核心作用**：
    - **固定访问点**：Pod 重建后 IP 会变，Service 提供固定 IP，客户端无需关心 Pod 变化；
    - **负载均衡**：自动将请求分发到后端健康的 Pod；
    - **服务发现**：通过 DNS （如 CoreDNS）实现 Service 名称与 IP 的映射，Pod 可通过 Service 名称访问其他服务。
- **类型**：ClusterIP（仅集群内访问）、NodePort（暴露节点端口，集群外可访问）、LoadBalancer（结合云厂商负载均衡器）、ExternalName（映射外部域名）。

#### 4. Deployment、StatefulSet、DaemonSet 有什么区别？

| 资源类型    | 适用场景                           | 核心特点                                                     |
| ----------- | ---------------------------------- | ------------------------------------------------------------ |
| Deployment  | 无状态应用（如 Web 服务、API）     | 管理 Pod 副本，支持滚动更新、回滚、扩缩容；Pod 无固定名称和存储，可随意替换。 |
| StatefulSet | 有状态应用（如数据库、分布式系统） | Pod 有固定名称（如 `web-0`、`web-1`）和稳定存储；更新顺序严格（先停旧再启新），支持有序扩缩容。 |
| DaemonSet   | 集群级守护进程（如日志收集、监控） | 确保所有（或指定）节点运行一个相同的 Pod 副本；节点新增时自动部署，节点删除时自动清理。 |

### 二、架构与核心组件

#### 5. Kubernetes 的架构是什么？控制平面（Control Plane）包含哪些组件？

- **架构**：采用 “控制平面 + 节点（Node）” 的分布式架构。
    - **控制平面**：负责集群的全局决策（如调度、部署、故障检测），可单节点或高可用部署（多副本）。
    - **节点（Node）**：运行容器的工作节点，受控制平面管理。
- **控制平面组件**：
    - **kube-apiserver**：所有操作的统一入口（REST API），负责认证、授权、数据校验，是唯一与 etcd 直接交互的组件。
    - **etcd**：集群的 “数据库”，存储集群所有状态（如 Pod 配置、Service 信息）。
    - **kube-scheduler**：负责 Pod 的调度，根据节点资源（CPU、内存）、亲和性、污点 / 容忍等策略，选择合适的节点运行 Pod。
    - **kube-controller-manager**：运行各种控制器进程（如 Deployment 控制器、节点控制器、Service 控制器），确保集群状态与期望状态一致（如 Pod 崩溃后重启）。
    - **cloud-controller-manager**：可选组件，对接云厂商 API（如负载均衡器、存储卷），仅在云环境中使用。

#### 6. 节点（Node）包含哪些组件？

- **kubelet**：运行在每个节点上的代理，负责管理节点上的 Pod（创建、启动、监控、停止），确保 Pod 按照容器规格（ContainerSpec）运行。
- **kube-proxy**：运行在每个节点上的网络代理，负责维护节点的网络规则（如 iptables 或 IPVS），实现 Service 对 Pod 的负载均衡和网络转发。
- **容器运行时（Container Runtime）**：如 Docker、containerd、CRI-O 等，负责运行容器（k8s 通过 CRI 接口与运行时交互）。

### 三、资源管理与调度

#### 7. 什么是资源限制（Resources Limits）和请求（Requests）？有什么区别？

- **Requests（请求）**：Pod 对资源的 “最小需求”，k8s 调度时确保节点有足够资源满足所有 Pod 的 Requests 总和（否则不调度到该节点）。

- **Limits（限制）**：Pod 能使用的 “最大资源上限”，防止单个 Pod 耗尽节点资源（如 CPU 超限会被限流，内存超限会被杀死）。

- **示例**：

    ```yaml
    resources:
      requests:
        cpu: "100m"  # 至少需要 0.1 核 CPU
        memory: "128Mi"  # 至少需要 128MB 内存
      limits:
        cpu: "500m"  # 最多使用 0.5 核 CPU
        memory: "256Mi"  # 最多使用 256MB 内存
    ```

    

#### 8. 什么是亲和性（Affinity）和反亲和性（Anti-Affinity）？

- **亲和性**：让 Pod 尽可能调度到满足条件的节点（或与特定 Pod 共处同一节点）。
    - 节点亲和性（Node Affinity）：基于节点标签（如 `disk=ssd`）调度，例如 “Pod 尽量跑在有 SSD 磁盘的节点上”。
    - Pod 亲和性（Pod Affinity）：基于其他 Pod 的标签调度，例如 “前端 Pod 尽量与后端 Pod 跑在同一节点，减少网络延迟”。
- **反亲和性**：让 Pod 尽可能避免调度到满足条件的节点（或与特定 Pod 共处）。
    - 例如：“数据库 Pod 避免与其他高负载 Pod 跑在同一节点”“同一服务的多个副本避免跑在同一节点（提高容灾性）”。

#### 9. 什么是污点（Taints）和容忍（Tolerations）？

- **污点（Taints）**：节点上的 “排斥标签”，用于阻止 Pod 调度到该节点（除非 Pod 明确 “容忍” 这个污点）。
    - 示例：给 Master 节点添加污点 `NoSchedule`，防止普通 Pod 调度到 Master 上。
- **容忍（Tolerations）**：Pod 上的 “许可配置”，表示 Pod 可以容忍节点的某个污点，允许被调度到该节点。
- **用途**：隔离特殊节点（如 GPU 节点仅允许机器学习 Pod 调度）、标记故障节点（暂时阻止新 Pod 调度）。

### 四、网络与存储

#### 10. Kubernetes 的网络模型是什么？它要解决什么问题？

- **网络模型**：k8s 采用 “扁平网络” 模型，核心原则是：
    - 每个 Pod 有独立的 IP 地址；
    - Pod 之间可直接通信（无需 NAT）；
    - Pod 与节点之间可直接通信。
- **解决的问题**：
    - 容器动态创建 / 销毁导致的 IP 变化问题；
    - 跨节点 Pod 通信问题；
    - 网络隔离（通过 NetworkPolicy 控制 Pod 间通信）。
- **实现方案**：常用 CNI（容器网络接口）插件，如 Flannel（ overlay 网络）、Calico（BGP 路由，支持网络策略）、Weave Net 等。

#### 11. 什么是 NetworkPolicy？它的作用是什么？

- **NetworkPolicy**：k8s 的网络安全规则，用于控制 Pod 之间的入站（Ingress）和出站（Egress）流量，实现 “微分段” 隔离。
- **作用**：
    - 限制 Pod 只能与特定服务通信（如 “只有前端 Pod 能访问后端 Pod”）；
    - 阻止外部未授权访问（如 “禁止数据库 Pod 被集群外访问”）。
- **依赖**：需要 CNI 插件支持（如 Calico、Cilium），否则 NetworkPolicy 不生效。

#### 12. 什么是 Volume？k8s 支持哪些类型的 Volume？

- **Volume**：Pod 中的存储抽象，用于解决容器重启后数据丢失的问题，可被 Pod 内的多个容器共享。
- **常见类型**：
    - **emptyDir**：临时存储，Pod 销毁时数据丢失（如容器间临时共享数据）；
    - **hostPath**：挂载节点的本地目录（数据在节点上持久化，但 Pod 调度到其他节点后无法访问）；
    - **PersistentVolume（PV）/PersistentVolumeClaim（PVC）**：集群级持久化存储，PV 是管理员提前创建的存储资源（如云盘、NFS），PVC 是用户对 PV 的 “申请”，解耦存储与使用；
    - **ConfigMap/Secret**：挂载配置文件或敏感信息（如数据库密码）到 Pod，避免硬编码。

### 五、运维与故障处理

#### 13. 如何实现 k8s 集群的高可用？

- **控制平面高可用**：
    - 多副本部署控制平面组件（apiserver、scheduler、controller-manager），apiserver 通过负载均衡器（如 HAProxy）暴露；
    - etcd 采用集群部署（至少 3 节点，奇数个），确保数据一致性和容错（允许 1 节点故障）。
- **节点高可用**：
    - 部署多个节点，通过反亲和性避免关键应用的所有副本集中在同一节点；
    - 配置节点自动修复（如 kubelet 健康检查，故障节点自动隔离）。
- **网络高可用**：采用冗余网络插件（如 Calico 双网卡），避免单点故障。

#### 14. Pod 处于 Pending 状态的可能原因有哪些？

- 资源不足：节点的 CPU / 内存无法满足 Pod 的 Requests，调度器无法找到合适节点；
- 节点污点：节点有污点，而 Pod 没有对应的容忍配置；
- 镜像拉取失败：镜像地址错误、私有仓库认证失败、网络问题导致镜像拉不下来；
- 卷挂载失败：PV 不存在、PVC 未绑定、hostPath 目录权限不足；
- 节点亲和性不满足：Pod 配置了亲和性规则，但没有节点符合条件。

#### 15. 什么是滚动更新（Rolling Update）和回滚（Rollback）？如何操作？

- **滚动更新**：Deployment 升级时，逐步替换旧版本 Pod（先启动一个新版本，再停止一个旧版本），确保服务不中断。
    - 操作：`kubectl set image deployment/<name> <container>=<new-image>`
- **回滚**：当更新出现问题时，恢复到之前的稳定版本。
    - 操作：`kubectl rollout undo deployment/<name>`（回滚到上一版本）；`kubectl rollout undo deployment/<name> --to-revision=<n>`（回滚到指定版本）。

### 六、进阶概念

#### 16. 什么是 Namespace？它的作用是什么？

- **Namespace**：集群内的资源隔离机制，将资源（Pod、Service、Deployment 等）划分为不同的 “命名空间”，逻辑上视为独立的子集群。
- **作用**：
    - 多团队 / 环境隔离（如 dev、test、prod 命名空间）；
    - 资源配额管理（限制每个 Namespace 的资源使用上限）；
    - 简化资源管理（通过 Namespace 过滤资源）。

#### 17. 什么是 ConfigMap 和 Secret？有什么区别？

- **ConfigMap**：存储非敏感配置数据（如配置文件、环境变量），以键值对形式存在，可通过环境变量或文件挂载到 Pod。
- **Secret**：存储敏感数据（如密码、Token、证书），数据会被 Base64 编码（非加密，需配合 RBAC 或外部加密工具增强安全性），使用方式与 ConfigMap 类似。
- **核心区别**：Secret 用于敏感数据，ConfigMap 用于非敏感配置。

#### 18. 什么是 RBAC？它的作用是什么？

- **RBAC（基于角色的访问控制）**：k8s 的权限管理机制，通过 “角色（Role）” 定义权限，“角色绑定（RoleBinding）” 将权限分配给用户（或 ServiceAccount）。
- **核心组件**：
    - **Role**：在单个 Namespace 内定义权限（如允许创建 Pod、查看 Service）；
    - **ClusterRole**：集群级别的角色，权限适用于所有 Namespace；
    - **RoleBinding**：将 Role 绑定到用户，作用范围为单个 Namespace；
    - **ClusterRoleBinding**：将 ClusterRole 绑定到用户，作用范围为整个集群。
- **作用**：精细化控制用户对集群资源的操作权限（如 “开发人员只能操作 dev 命名空间的资源”），确保集群安全。

### 总结

k8s 面试题围绕 “核心概念理解”“架构组件作用”“资源与调度逻辑”“网络存储机制”“运维故障处理” 展开，重点考察对分布式容器编排的整体认知和实践经验。掌握这些知识点，不仅能应对面试，更能为实际运维和开发打下基础。